<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Echo - An RCOS Project</title>
    <link rel="stylesheet" href="https://pyscript.net/releases/2024.6.1/core.css">
    <script type="module" src="https://pyscript.net/releases/2024.6.1/core.js"></script>
    <link rel="stylesheet" href="https://pyscript.net/alpha/pyscript.css" />
    <script defer src="https://pyscript.net/alpha/pyscript.js"></script>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <header class="main-header">
        <div class="header-welcome">Welcome to Echo!</div>
        <div class="header-desc">
            Create meeting recordings/audio into organized meeting minutes
        </div>
    </header>

    <main>
        <!-- Selection Section -->
        <section class="selection-section">
            <h1>Choose an Option</h1>
            <button onclick="showSection('file-input-section')">Upload Your Files</button>
            <button onclick="showSection('record-audio-section')">Record Audio</button>
        </section>

        <section class="file-input-section" style="display: none;">
            <h1>Upload Your Files</h1>
            <form id="user-form">
                <div class="input-group">
                    <label for="wav-input">WAV File:</label>
                    <input type="file" id="wav-input" name="wav-input" accept=".wav">
                </div>
                <div class="input-group">
                    <label for="file-input">Document File Name:</label>
                    <input type="text" id="file-input" name="file-input" placeholder="Enter filename">
                </div>
                <button type="button" onclick="handleInput()">Submit</button>
            </form>
            <p id="output"></p>
        </section>

        <section class="record-audio-section" style="display: none;">
            <h1>Record Audio</h1>
            <button id="record-btn" onclick="startRecording()">Start Recording</button>
            <button id="stop-btn" onclick="stopRecording()" disabled>Stop Recording</button>
            <audio id="audio-playback" controls></audio>
            <p id="transcription-output"></p>
        </section>
    </main>

    <script>
        let mediaRecorder;
        let audioChunks = [];

        function startRecording() {
            navigator.mediaDevices.getUserMedia({ audio: true })
                .then(stream => {
                    mediaRecorder = new MediaRecorder(stream);
                    mediaRecorder.ondataavailable = event => {
                        audioChunks.push(event.data);
                    };
                    mediaRecorder.onstop = () => {
                        const audioBlob = new Blob(audioChunks, { type: 'audio/wav' });
                        audioChunks = [];

                        const audioUrl = URL.createObjectURL(audioBlob);
                        const audio = document.getElementById("audio-playback");
                        audio.src = audioUrl;

                        // Call the PyScript function to save the WAV file
                        pyodide.runPython(`window.save_wav_file(to_js(audioBlob))`);
                    };
                    mediaRecorder.start();

                    document.getElementById("record-btn").disabled = true;
                    document.getElementById("stop-btn").disabled = false;
                });
        }

        function stopRecording() {
            mediaRecorder.stop();

            document.getElementById("record-btn").disabled = false;
            document.getElementById("stop-btn").disabled = true;
        }

        // Function to show the selected section and hide others
        function showSection(sectionClass) {
            const sections = document.querySelectorAll('main section');
            sections.forEach(section => {
                if (section.classList.contains(sectionClass)) {
                    section.style.display = 'block';
                } else if (!section.classList.contains('selection-section')) {
                    section.style.display = 'none';
                }
            });
        }

        // Initial setup to show only the selection section
        document.addEventListener('DOMContentLoaded', () => {
            showSection('selection-section');
        });
    </script>
</body>
</html>
